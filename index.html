<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°© ê¾¸ë¯¸ê¸°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
            background: #333;
        }
        .hidden {
            display: none;
        }
        #app {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .background-options img {
            width: 150px;
            cursor: pointer;
            margin: 10px;
            border: 2px solid transparent;
        }
        .background-options img.selected {
            border: 2px solid #ff4d4d;
        }
        .room {
            width: 100%;
            height: 500px;
            margin: 20px auto;
            border: 3px solid white;
            background-size: cover;
            background-position: center;
        }
        .note {
            background: #fff;
            color: #333;
            padding: 10px;
            margin: 10px;
            border-radius: 5px;
            text-align: left;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 18px;
            cursor: pointer;
        }
        .note-options {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- ë©”ì¸ í™”ë©´ -->
        <div id="main-section">
            <h1>ğŸ„ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ë°© ê¾¸ë¯¸ê¸° ğŸ„</h1>
            <button onclick="goToSection('user-info-section')">ì‹œì‘í•˜ê¸°</button>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ ì…ë ¥ -->
        <div id="user-info-section" class="hidden">
            <h2>ğŸ… ë°© ë§Œë“¤ê¸°</h2>
            <input type="text" id="user-name" placeholder="ì´ë¦„ ì…ë ¥" />
            <input type="password" id="user-password" maxlength="4" placeholder="ë¹„ë°€ë²ˆí˜¸ (ìˆ«ì 4ìë¦¬)" />
            <button onclick="saveUserInfo()">ë‹¤ìŒ</button>
        </div>

        <!-- ë°© ê¾¸ë¯¸ê¸° -->
        <div id="decorate-room-section" class="hidden">
            <h2>ğŸ„ ë°© ê¾¸ë¯¸ê¸°</h2>
            <div class="background-options">
                <h3>ğŸ“· ë°© ë°°ê²½ ì„ íƒ</h3>
                <img src="img237_room1.png" data-bg="img237_room1.png" alt="ë°©1" onclick="selectBackground(this)">
                <img src="img237_room2.png" data-bg="img237_room2.png" alt="ë°©2" onclick="selectBackground(this)">
                <img src="img237_room3.png" data-bg="img237_room3.png" alt="ë°©3" onclick="selectBackground(this)">
                <img src="img237_room4.png" data-bg="img237_room4.png" alt="ë°©4" onclick="selectBackground(this)">
                <img src="img237_room5.png" data-bg="img237_room5.png" alt="ë°©5" onclick="selectBackground(this)">
                <img src="img237_room6.png" data-bg="img237_room6.png" alt="ë°©6" onclick="selectBackground(this)">
                <img src="img237_room7.png" data-bg="img237_room7.png" alt="ë°©7" onclick="selectBackground(this)">
                <img src="img237_room8.png" data-bg="img237_room8.png" alt="ë°©8" onclick="selectBackground(this)">
            </div>
            <div class="room" id="room"></div>
            <button onclick="saveBackground()">ì™„ë£Œ</button>
        </div>

        <!-- ê³ ìœ  ë§í¬ -->
        <div id="link-section" class="hidden">
            <h2>ğŸ‰ ë‚˜ë§Œì˜ ë°© ì™„ì„±!</h2>
            <div>
                <h3>ê³ ìœ  ë§í¬</h3>
                <a id="unique-link" target="_blank"></a>
                <button onclick="copyLink()">ë§í¬ ë³µì‚¬í•˜ê¸°</button>
            </div>
        </div>

        <!-- ìª½ì§€ ì‘ì„± -->
        <div id="note-section" class="hidden">
            <h2>ğŸ“œ ìª½ì§€ ë‹¬ê¸°</h2>
            <textarea id="note-content" placeholder="ìª½ì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 80%; height: 100px;"></textarea>
            <select id="note-paper">
                <option value="paper1">í¸ì§€ì§€ 1</option>
                <option value="paper2">í¸ì§€ì§€ 2</option>
            </select>
            <select id="note-sticker">
                <option value="sticker1">ìŠ¤í‹°ì»¤ 1</option>
                <option value="sticker2">ìŠ¤í‹°ì»¤ 2</option>
            </select>
            <button onclick="addNote()">ìª½ì§€ ë‹¬ê¸°</button>
            <div id="notes"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script>
        // Firebase ì´ˆê¸°í™”
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let selectedBackground = null;
        let userId = null;

        // ì„¹ì…˜ ì „í™˜
        function goToSection(sectionId) {
            document.querySelectorAll("#app > div").forEach(section => section.classList.add("hidden"));
            document.getElementById(sectionId).classList.remove("hidden");
        }

        // ì‚¬ìš©ì ì •ë³´ ì €ì¥
        function saveUserInfo() {
            const name = document.getElementById('user-name').value.trim();
            const password = document.getElementById('user-password').value.trim();

            if (!name || password.length !== 4 || isNaN(password)) {
                alert("ì´ë¦„ê³¼ 4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            userId = `${name}-${Date.now()}`;
            database.ref('rooms/' + userId).set({
                name: name,
                password: password
            });

            goToSection("decorate-room-section");
        }

        // ë°°ê²½ ì„ íƒ
        function selectBackground(img) {
            document.querySelectorAll('.background-options img').forEach(el => el.classList.remove('selected'));
            img.classList.add('selected');
            selectedBackground = img.getAttribute('data-bg');
            document.getElementById('room').style.backgroundImage = `url(${selectedBackground})`;
        }

        // ë°°ê²½ ì €ì¥ ë° ê³ ìœ  ë§í¬ ìƒì„±
        function saveBackground() {
            if (!selectedBackground) {
                alert("ë°°ê²½ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            database.ref('rooms/' + userId).update({
                background: selectedBackground
            });

            const uniqueLink = `${window.location.origin}/?room=${userId}`;
            document.getElementById('unique-link').href = uniqueLink;
            document.getElementById('unique-link').textContent = uniqueLink;

            goToSection("link-section");
        }

        // ê³ ìœ  ë§í¬ ë³µì‚¬
        function copyLink() {
            const link = document.getElementById('unique-link').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
            });
        }

        // ìª½ì§€ ì¶”ê°€
        function addNote() {
            const noteContent = document.getElementById('note-content').value.trim();
            const notePaper = document.getElementById('note-paper').value;
            const noteSticker = document.getElementById('note-sticker').value;

            if (!noteContent) {
                alert("ìª½ì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
                return;
            }

            database.ref('rooms/' + userId + '/notes').once('value', (snapshot) => {
                if (snapshot.numChildren() >= 5) {
                    alert("ìª½ì§€ëŠ” ìµœëŒ€ 5ê°œê¹Œì§€ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                    return;
                }

                database.ref('rooms/' + userId + '/notes').push({
                    content: noteContent,
                    paper: notePaper,
                    sticker: noteSticker,
                    timestamp: Date.now()
                });

                document.getElementById('note-content').value = ''; // ì…ë ¥ ì°½ ì´ˆê¸°í™”
                loadNotes();
            });
        }

        // ìª½ì§€ ë¡œë“œ
        function loadNotes() {
            const notesContainer = document.getElementById('notes');
            notesContainer.innerHTML = ''; // ì´ˆê¸°í™”
            database.ref('rooms/' + userId + '/notes').on('value', (snapshot) => {
                snapshot.forEach((childSnapshot) => {
                    const note = childSnapshot.val();
                    const noteElement = document.createElement('div');
                    noteElement.classList.add('note');
                    noteElement.innerHTML = `
                        <div class="note-options">
                            <span>${note.content}</span>
                            <button onclick="deleteNote('${childSnapshot.key}')">ì‚­ì œ</button>
                        </div>`;
                    notesContainer.appendChild(noteElement);
                });
            });
        }

        // ìª½ì§€ ì‚­ì œ (ê´€ë¦¬ìë§Œ)
        function deleteNote(noteId) {
            const password = prompt("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            if (!password) return;

            database.ref('rooms/' + userId).once('value').then((snapshot) => {
                const roomData = snapshot.val();
                if (roomData.password === password) {
                    database.ref('rooms/' + userId + '/notes/' + noteId).remove();
                    loadNotes();
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            });
        }

        // ê³ ìœ  ë§í¬ë¡œ ë°© ì ‘ì†
        const params = new URLSearchParams(window.location.search);
        const roomParam = params.get("room");
        if (roomParam) {
            database.ref('rooms/' + roomParam).once('value').then((snapshot) => {
                const roomData = snapshot.val();
                if (roomData) {
                    document.getElementById('room').style.backgroundImage = `url(${roomData.background})`;
                    userId = roomParam;
                    loadNotes();
                    goToSection("note-section");
                } else {
                    alert("ë°© ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
            });
        }
    </script>
</body>
</html>
